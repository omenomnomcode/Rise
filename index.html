<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Rise">
<meta name="theme-color" content="#0a0a0f">
<title>Rise</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Newsreader:ital,wght@0,200;0,300;0,400;1,200;1,300;1,400&family=Overpass:wght@300;400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{
  --bg:#0a0a0f;--gold:#c4933f;--gold-l:#e8b44f;--gold-g:#f4c97e;
  --cream:#e8e0d4;--cream-l:#f0e6d6;--tan:#b8a890;--tan-d:#8a7a6a;--brown:#6a5a4a;--brown-d:#5a5550;--brown-dd:#4a4540;
  --red:#d4736a;--green:#6abf7a;
  --card:rgba(255,255,255,0.03);--border:rgba(255,255,255,0.06);
  --sat:env(safe-area-inset-top,0px);--sab:env(safe-area-inset-bottom,0px);
}
body{
  min-height:100vh;min-height:-webkit-fill-available;
  background:linear-gradient(145deg,#0a0a0f 0%,#111127 40%,#1a0a2e 70%,#0a0a0f 100%);
  color:var(--cream);font-family:'Newsreader','Georgia',serif;
  overflow-x:hidden;-webkit-font-smoothing:antialiased;
}
.s{font-family:'Overpass','Helvetica Neue',sans-serif}
.particles{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
.p{position:absolute;border-radius:50%;animation:fp var(--d) ease-in-out infinite;animation-delay:var(--dl)}
@keyframes fp{0%,100%{transform:translateY(0) translateX(0)}50%{transform:translateY(-30px) translateX(15px)}}
@keyframes fi{from{opacity:0}to{opacity:1}}
@keyframes su{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
@keyframes si{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}

.wrap{max-width:440px;margin:0 auto;padding:calc(40px + var(‚Äìsat)) 24px calc(40px + var(‚Äìsab));position:relative;z-index:1;animation:si .8s cubic-bezier(.16,1,.3,1)}
.hdr{text-align:center;margin-bottom:48px}
.logo{font-size:13px;letter-spacing:6px;text-transform:uppercase;color:var(‚Äìgold);margin-bottom:8px;font-weight:300}
.ttl{font-size:36px;font-weight:300;line-height:1.1;color:var(‚Äìcream-l);font-style:italic}
.ttl-s{font-size:28px}
.sub{font-size:14px;color:var(‚Äìtan-d);margin-top:12px;font-weight:300;letter-spacing:.5px}
.card{background:var(‚Äìcard);border:1px solid var(‚Äìborder);border-radius:16px;padding:28px 24px;margin-bottom:20px;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px)}
.cl{font-size:10px;letter-spacing:4px;text-transform:uppercase;color:var(‚Äìtan-d);margin-bottom:12px;font-weight:400}
.bn{font-size:64px;font-weight:200;color:var(‚Äìgold-g);line-height:1;font-style:italic}
.bu{font-size:16px;color:var(‚Äìtan-d);font-weight:300;margin-left:8px;font-style:normal}
.btn{width:100%;padding:18px 24px;border:none;border-radius:12px;font-size:14px;font-weight:500;letter-spacing:2px;text-transform:uppercase;cursor:pointer;transition:all .3s cubic-bezier(.16,1,.3,1);margin-bottom:12px;-webkit-appearance:none;font-family:‚ÄòOverpass‚Äô,sans-serif}
.btn:active:not(:disabled){transform:scale(.98)}.btn:disabled{opacity:.5;cursor:not-allowed}
.bp{background:linear-gradient(135deg,var(‚Äìgold),var(‚Äìgold-l));color:var(‚Äìbg)}
.bs{background:rgba(255,255,255,.05);color:var(‚Äìtan);border:1px solid rgba(255,255,255,.08)}
.bd{background:rgba(180,60,60,.15);color:var(‚Äìred);border:1px solid rgba(180,60,60,.2)}
.bx{background:rgba(255,255,255,.03);color:var(‚Äìbrown-dd)}
input{width:100%;padding:14px 16px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:10px;color:var(‚Äìcream);font-size:15px;font-family:‚ÄòOverpass‚Äô,sans-serif;outline:none;margin-bottom:14px;-webkit-appearance:none;transition:border-color .3s}
input:focus{border-color:rgba(196,147,63,.4)}input::placeholder{color:var(‚Äìbrown-d)}
.il{font-size:11px;letter-spacing:2px;text-transform:uppercase;color:#7a6a5a;display:block;margin-bottom:8px}
.pt{display:inline-block;padding:5px 14px;border-radius:20px;font-size:10px;letter-spacing:3px;text-transform:uppercase;font-weight:500}
.pt1{background:rgba(180,60,60,.12);color:var(‚Äìred);border:1px solid rgba(180,60,60,.2)}
.pt2{background:rgba(196,147,63,.15);color:var(‚Äìgold-l);border:1px solid rgba(196,147,63,.25)}
.wg{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;text-align:center}
.dd{width:36px;height:36px;border-radius:50%;margin:0 auto;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:500;transition:all .3s}
.dd-v{background:linear-gradient(135deg,var(‚Äìgold),var(‚Äìgold-l));color:var(‚Äìbg);border:1px solid transparent}
.dd-m{background:rgba(180,60,60,.25);color:var(‚Äìred);border:1px solid rgba(180,60,60,.3)}
.dd-e{background:rgba(255,255,255,.04);color:var(‚Äìbrown-d);border:1px solid var(‚Äìborder)}
.dl{font-size:10px;color:var(‚Äìbrown-d);margin-top:6px}
.sd{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600;flex-shrink:0}
.sd-d{background:linear-gradient(135deg,var(‚Äìgold),var(‚Äìgold-l));color:var(‚Äìbg)}
.sd-p{background:rgba(255,255,255,.06);color:var(‚Äìtan-d)}
.sg{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;text-align:center}
.sn{font-size:28px;font-weight:200;font-style:italic}
.sl{font-size:10px;color:var(‚Äìbrown);letter-spacing:1px;text-transform:uppercase;margin-top:4px}
.dv{height:1px;background:rgba(255,255,255,.05);margin:32px 0}
.ao{position:fixed;inset:0;background:rgba(0,0,0,.88);display:flex;align-items:center;justify-content:center;z-index:100;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);animation:fi .6s ease}
.ac{max-width:360px;padding:48px 36px;text-align:center;animation:su .8s cubic-bezier(.16,1,.3,1)}
.at{font-size:28px;font-weight:300;font-style:italic;color:var(‚Äìgold-g);line-height:1.4;margin-bottom:32px}
.jc{background:rgba(180,60,60,.08);border:1px solid rgba(180,60,60,.15);border-radius:16px;padding:24px;margin-bottom:20px;text-align:center}
.tc{text-align:center}
.sr{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.ft{text-align:center;margin-top:32px;padding-bottom:40px;font-size:11px;color:#3a3530;letter-spacing:1px}
#mapc{width:100%;height:280px;border-radius:12px;overflow:hidden;margin-bottom:14px;border:1px solid rgba(255,255,255,.08)}
.leaflet-container{background:#1a1a2e!important}
.msh{position:relative;margin-bottom:14px}
#msrch{margin-bottom:0;padding-right:50px}
.msb{position:absolute;right:2px;top:2px;bottom:2px;background:linear-gradient(135deg,var(‚Äìgold),var(‚Äìgold-l));border:none;color:var(‚Äìbg);font-size:14px;cursor:pointer;padding:0 14px;border-radius:8px;font-family:‚ÄòOverpass‚Äô,sans-serif;font-weight:500;width:auto;letter-spacing:0;text-transform:none}
.lc{font-size:13px;color:var(‚Äìgreen);text-align:center;margin-bottom:8px}
.lcc{font-size:11px;color:var(‚Äìbrown-d);text-align:center;margin-bottom:14px}
.sov{position:fixed;inset:0;background:rgba(0,0,0,.92);z-index:90;overflow-y:auto;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);animation:fi .3s ease}
.soi{max-width:440px;margin:0 auto;padding:calc(40px + var(‚Äìsat)) 24px calc(40px + var(‚Äìsab))}
</style>

</head>
<body>
<div class="particles" id="ptr"></div>
<div id="app"></div>

<script>
(function(){
var JOKES=[
"I'm reading a book about anti-gravity. It's impossible to put down!",
"Why did the scarecrow win an award? He was outstanding in his field!",
"I told my wife she was drawing her eyebrows too high. She looked surprised.",
"What do you call a fake noodle? An impasta!",
"Why don't skeletons fight each other? They don't have the guts.",
"I used to hate facial hair, but then it grew on me.",
"What did the ocean say to the beach? Nothing, it just waved.",
"Why do cows have hooves instead of feet? Because they lactose.",
"I'm on a seafood diet. I see food and I eat it.",
"What do you call a bear with no teeth? A gummy bear!",
"Why did the gym close down? It just didn't work out!",
"I told my personal trainer I wanted to do crunches. He said 'Nestl√© or Frito-Lay?'",
"Why don't scientists trust atoms? Because they make up everything!",
"Did you hear about the claustrophobic astronaut? He just needed a little space.",
"I would avoid the sushi if I were you. It's a little fishy.",
"Why did the bicycle fall over? Because it was two-tired!",
"What's the best thing about Switzerland? I don't know, but the flag is a big plus.",
"I got fired from the calendar factory. All I did was take a day off.",
"Why don't eggs tell jokes? They'd crack each other up!",
"I asked the gym instructor to teach me to do the splits. He said 'How flexible are you?' I said 'I can't make Tuesdays.'"
];
var AFFS=[
"You showed up. That's what champions do.",
"21 days strong. You're not the same person who started.",
"Your discipline is building something extraordinary.",
"The hardest part was starting. You've already won.",
"Every morning you choose yourself. That's power.",
"You're proof that consistency beats motivation.",
"The gym doesn't make you strong. Showing up does.",
"You didn't hit snooze on your potential today.",
"This isn't a streak ‚Äî it's who you are now.",
"The person you're becoming is worth the early alarm.",
"You're outworking yesterday's version of yourself.",
"Discipline is just love for your future self.",
"Most people are still asleep. You're already winning.",
"Your body thanks you. Your mind thanks you. Keep going.",
"You're not just building a habit ‚Äî you're building a life."
];
var TH=21,RAD=200,WIN={o:4,c:5.5};

var S={scr:'home',str:0,hist:{},ci:false,vl:false,gps:'idle',joke:null,aff:false,afft:'',cn:'',cp:'',gl:{lat:39.7392,lng:-104.9903},gn:'My Gym',setup:false,gs:false,showSet:false,selLoc:null};
var mp=null,mk=null,cr=null;

function tk(){return new Date().toISOString().split('T')[0]}
function ft(d){return d.toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',hour12:true})}
function fd(d){return d.toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric'})}
function gd(a,b,c,d){var R2=6371e3,p=Math.PI/180,x=a*p,y=c*p,dp=(c-a)*p,dl=(d-b)*p,q=Math.sin(dp/2)**2+Math.cos(x)*Math.cos(y)*Math.sin(dl/2)**2;return R2*2*Math.atan2(Math.sqrt(q),Math.sqrt(1-q))}
function rnd(a){return a[Math.floor(Math.random()*a.length)]}
function esc(t){return String(t).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}
function save(){try{localStorage.setItem('rise',JSON.stringify({str:S.str,hist:S.hist,cn:S.cn,cp:S.cp,gl:S.gl,gn:S.gn,setup:S.setup}))}catch(e){}}
function load(){try{var d=JSON.parse(localStorage.getItem('rise')||'{}');if(d.str!=null)S.str=d.str;if(d.hist)S.hist=d.hist;if(d.cn)S.cn=d.cn;if(d.cp)S.cp=d.cp;if(d.gl){S.gl=d.gl;S.gs=true}if(d.gn)S.gn=d.gn;if(d.setup){S.setup=true;S.scr='dashboard'}var t=tk();if(S.hist[t]){if(S.hist[t].ci)S.ci=true;if(S.hist[t].vl)S.vl=true;if(S.hist[t].ms)S.joke=S.hist[t].jk}}catch(e){}}

function initP(){var h='',el=document.getElementById('ptr');for(var i=0;i<20;i++){var sz=2+Math.random()*4,op=.1+Math.random()*.2;h+='<div class="p" style="width:'+sz+'px;height:'+sz+'px;background:rgba(255,180,80,'+op+');left:'+Math.random()*100+'%;top:'+Math.random()*100+'%;--d:'+(8+Math.random()*12)+'s;--dl:'+(Math.random()*-10)+'s"></div>'}el.innerHTML=h}

// ‚îÄ‚îÄ Map ‚îÄ‚îÄ
function initMap(lat,lng){
  if(mp){mp.remove();mp=null;mk=null;cr=null}
  setTimeout(function(){
    var el=document.getElementById('mapc');
    if(!el)return;
    mp=L.map('mapc',{zoomControl:true,attributionControl:false}).setView([lat,lng],15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(mp);
    var ico=L.divIcon({className:'',html:'<div style="width:30px;height:30px;background:linear-gradient(135deg,#c4933f,#e8b44f);border-radius:50%;border:3px solid #fff;box-shadow:0 2px 10px rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;font-size:15px">üèãÔ∏è</div>',iconSize:[30,30],iconAnchor:[15,15]});
    mk=L.marker([lat,lng],{icon:ico,draggable:true}).addTo(mp);
    cr=L.circle([lat,lng],{radius:RAD,color:'#c4933f',fillColor:'#c4933f',fillOpacity:.1,weight:1.5,dashArray:'6,4'}).addTo(mp);
    S.selLoc={lat:lat,lng:lng};
    mk.on('dragend',function(e){var ll=e.target.getLatLng();S.selLoc={lat:ll.lat,lng:ll.lng};cr.setLatLng(ll);updLoc()});
    mp.on('click',function(e){mk.setLatLng(e.latlng);cr.setLatLng(e.latlng);S.selLoc={lat:e.latlng.lat,lng:e.latlng.lng};updLoc()});
    updLoc();
  },150);
}
function updLoc(){var el=document.getElementById('locd');if(el&&S.selLoc)el.innerHTML='<div class="lc s">‚úì Location selected</div><div class="lcc s">'+S.selLoc.lat.toFixed(5)+', '+S.selLoc.lng.toFixed(5)+'</div>'}
function searchLoc(q){
  if(!q)return;
  fetch('https://nominatim.openstreetmap.org/search?format=json&q='+encodeURIComponent(q)+'&limit=1')
  .then(function(r){return r.json()})
  .then(function(d){
    if(d&&d.length){
      var lat=parseFloat(d[0].lat),lng=parseFloat(d[0].lon);
      if(mp){mp.setView([lat,lng],16);mk.setLatLng([lat,lng]);cr.setLatLng([lat,lng]);S.selLoc={lat:lat,lng:lng};updLoc();
        var gn=document.getElementById('xg')||document.getElementById('sg');
        if(gn&&!gn.value){gn.value=d[0].display_name.split(',')[0];S.gn=gn.value}
      }
    }else{alert('Location not found. Try a more specific search.')}
  }).catch(function(){alert('Search failed. Check your connection.')});
}
function geoMap(){
  if(!navigator.geolocation)return;
  navigator.geolocation.getCurrentPosition(function(p){
    var lat=p.coords.latitude,lng=p.coords.longitude;
    if(mp){mp.setView([lat,lng],16);mk.setLatLng([lat,lng]);cr.setLatLng([lat,lng]);S.selLoc={lat:lat,lng:lng};updLoc()}
  },function(){},{enableHighAccuracy:true});
}

function render(){
var app=document.getElementById('app'),now=new Date(),hr=now.getHours()+now.getMinutes()/60;
var inW=hr>=WIN.o&&hr<=WIN.c,past=hr>WIN.c,ph=S.str>=TH?2:1;
var done=0,missed=0;for(var k in S.hist){if(S.hist[k].vl)done++;if(S.hist[k].ms)missed++}
var w7=[];for(var i=6;i>=0;i--){var d=new Date();d.setDate(d.getDate()-i);var key=d.toISOString().split('T')[0],dn=d.toLocaleDateString('en-US',{weekday:'short'}),rec=S.hist[key]||{};w7.push({dn:dn,st:rec.vl?'v':rec.ms?'m':'e',sy:rec.vl?'‚úì':rec.ms?'‚úï':'¬∑'})}

// ‚îÄ‚îÄ Map card HTML (reused in setup + settings) ‚îÄ‚îÄ
function mapCard(prefix){
  return `<div class="card">
  <div class="cl s">Gym Location</div>
  <label class="il s">Gym Name</label>
  <input id="${prefix}g" value="${esc(S.gn)}" placeholder="e.g. Planet Fitness Downtown">
  <div class="msh">
    <input id="msrch" placeholder="Search address or gym name..." class="s">
    <button class="msb" id="msgo">Search</button>
  </div>
  <div id="mapc"></div>
  <p class="s tc" style="font-size:11px;color:var(--brown-d);margin-bottom:14px;line-height:1.5">Tap the map or drag the üèãÔ∏è pin to your gym.<br>Gold circle = 200m check-in radius.</p>
  <button class="btn bs" style="font-size:12px" id="${prefix}geo">üìç Use My Current Location</button>
  <div id="locd"></div>
</div>`}

// ‚îÄ‚îÄ Settings Overlay ‚îÄ‚îÄ
if(S.showSet){
app.innerHTML=`<div class="sov"><div class="soi">
  <div style="text-align:center;margin-bottom:32px">
    <div class="logo s">Rise</div>
    <h1 class="ttl" style="font-size:24px">Settings</h1>
  </div>
  <div class="card">
    <div class="cl s">Accountability Contact</div>
    <label class="il s">Contact Name</label>
    <input id="sn" value="${esc(S.cn)}" placeholder="e.g. Mom, Best Friend">
    <label class="il s">Phone Number</label>
    <input id="sp" value="${esc(S.cp)}" placeholder="+1 (555) 123-4567" type="tel">
  </div>
  ${mapCard('s')}
  <button class="btn bp" id="ssave">Save Settings</button>
  <button class="btn bs" id="scanc">Cancel</button>
  <div class="dv"></div>
  <button class="btn bd" style="font-size:11px" id="srst">Reset All Data</button>
</div></div>`;
bindIn('sn',function(v){S.cn=v});bindIn('sp',function(v){S.cp=v});bindIn('sg',function(v){S.gn=v});
bi('msrch','keydown',function(e){if(e.key==='Enter'){e.preventDefault();searchLoc(e.target.value)}});
bi('msgo','click',function(){var el=document.getElementById('msrch');if(el)searchLoc(el.value)});
bi('sgeo','click',geoMap);
bi('ssave','click',function(){if(S.selLoc){S.gl=S.selLoc;S.gs=true}S.showSet=false;save();render()});
bi('scanc','click',function(){S.showSet=false;render()});
bi('srst','click',function(){if(confirm('Reset all data? Cannot be undone.')){localStorage.removeItem('rise');location.reload()}});
initMap(S.gl.lat,S.gl.lng);
return;
}

if(!S.setup){
// ‚îÄ‚îÄ Setup ‚îÄ‚îÄ
app.innerHTML=`<div class="wrap">
  <div class="hdr">
    <div class="logo s">Rise</div>
    <h1 class="ttl">Morning Accountability</h1>
    <p class="sub s">Build the habit. Become the person.</p>
  </div>
  <div class="card">
    <div class="cl s">Your Details</div>
    <p class="s" style="font-size:14px;color:#9a8a7a;line-height:1.7;margin-bottom:20px">Set up your accountability partner and gym location.</p>
    <label class="il s">Accountability Contact Name</label>
    <input id="xn" value="${esc(S.cn)}" placeholder="e.g. Mom, Best Friend">
    <label class="il s">Their Phone Number</label>
    <input id="xp" value="${esc(S.cp)}" placeholder="+1 (555) 123-4567" type="tel">
  </div>
  ${mapCard('x')}
  <button class="btn bp" id="xgo" ${!S.cn||!S.cp?'disabled style="opacity:.4"':''}>Begin ‚Üí</button>
</div>`;
bindIn('xn',function(v){S.cn=v});bindIn('xp',function(v){S.cp=v});bindIn('xg',function(v){S.gn=v});
bi('msrch','keydown',function(e){if(e.key==='Enter'){e.preventDefault();searchLoc(e.target.value)}});
bi('msgo','click',function(){var el=document.getElementById('msrch');if(el)searchLoc(el.value)});
bi('xgeo','click',geoMap);
bi('xgo','click',function(){if(S.selLoc){S.gl=S.selLoc;S.gs=true}S.setup=true;S.scr='dashboard';save();render()});
initMap(S.gl.lat,S.gl.lng);
return;
}

// ‚îÄ‚îÄ Dashboard ‚îÄ‚îÄ
var ciH='';
if(S.vl){
  ciH='<div class="tc" style="padding:12px 0"><div style="font-size:40px;margin-bottom:12px">‚ú¶</div><div style="font-size:18px;font-style:italic;color:var(--gold-l);margin-bottom:8px">You showed up today.</div><div class="s" style="font-size:12px;color:var(--brown)">Check-in complete ¬∑ See you tomorrow at 4 AM</div></div>';
}else if(S.joke){
  ciH='<div class="jc"><div class="s" style="font-size:12px;color:var(--red);letter-spacing:2px;text-transform:uppercase;margin-bottom:12px">Dad Joke Sent to '+esc(S.cn)+'</div><div style="font-size:16px;font-style:italic;color:#e8d0b0;line-height:1.6">"'+esc(S.joke)+'"</div></div><div class="s tc" style="font-size:12px;color:var(--brown)">Streak reset to 0. Get back at it tomorrow.</div>';
}else{
  var cit=S.ci&&S.hist[tk()]&&S.hist[tk()].cit?ft(new Date(S.hist[tk()].cit)):'';
  var s1=S.ci?'Checked in at '+cit:inW?'Window open ‚Äî check in now':past?'Window closed':'Opens at 4:00 AM';
  ciH='<div style="margin-bottom:16px"><div class="sr"><div class="sd s '+(S.ci?'sd-d':'sd-p')+'">'+(S.ci?'‚úì':'1')+'</div><div><div class="s" style="font-size:14px;font-weight:500;color:'+(S.ci?'var(--tan)':'var(--cream)')+'">Morning Check-In</div><div class="s" style="font-size:11px;color:var(--brown-d)">'+s1+'</div></div></div>';
  if(!S.ci)ciH+='<button class="btn '+(inW?'bp':'bx')+'" id="bci" '+(inW?'':'disabled')+'>'+(inW?"I'm Awake ‚òÄ":past?'Window Closed':'Not Yet Available')+'</button>';
  ciH+='</div><div><div class="sr"><div class="sd s '+(S.vl?'sd-d':'sd-p')+'">'+(S.vl?'‚úì':'2')+'</div><div><div class="s" style="font-size:14px;font-weight:500;color:'+(!S.ci?'var(--brown-dd)':'var(--cream)')+'">GPS Verification ‚Äî '+esc(S.gn)+'</div><div class="s" style="font-size:11px;color:var(--brown-d)">'+(S.gps==='checking'?'Checking location...':S.gps==='too_far'?'Too far ‚Äî get closer and retry':'Must be within 200m of your gym')+'</div></div></div>';
  if(S.ci&&!S.vl)ciH+='<button class="btn '+(S.gps==='checking'?'bx':'bp')+'" id="bgps" '+(S.gps==='checking'?'disabled':'')+'>'+(S.gps==='checking'?'üì° Verifying...':S.gps==='too_far'?'Try Again':"Verify I'm at the Gym")+'</button>';
  ciH+='</div>';
  if(past&&!S.ci&&!S.joke)ciH+='<div class="dv"></div><div class="tc"><div class="s" style="font-size:13px;color:var(--red);margin-bottom:12px">You missed today\'s window (4:00 ‚Äì 5:30 AM)</div><button class="btn bd" id="bmiss">Send Dad Joke to '+esc(S.cn)+' üò¨</button></div>';
  if(!inW&&!past)ciH+='<div class="dv"></div><p class="s tc" style="font-size:11px;color:var(--brown-dd);margin-bottom:12px">Demo mode ‚Äî test outside check-in window</p><button class="btn bs" style="font-size:11px" id="dci">Demo: Check In</button>'+(S.ci?'<button class="btn bs" style="font-size:11px" id="dgps">Demo: Verify GPS</button>':'')+'<button class="btn bd" style="font-size:11px" id="dmiss">Demo: Miss Day</button>';
}
var wH='';for(var i=0;i<w7.length;i++){var w=w7[i];wH+='<div><div class="dd s dd-'+w.st+'">'+w.sy+'</div><div class="dl s">'+w.dn+'</div></div>'}

app.innerHTML=(S.aff?'<div class="ao" id="aov"><div class="ac"><div style="font-size:48px;margin-bottom:24px">‚ú¶</div><div class="at">'+esc(S.afft)+'</div><div class="s" style="font-size:12px;color:#7a6a5a;letter-spacing:2px;text-transform:uppercase">Day '+S.str+' ¬∑ Tap to continue</div></div></div>':'')+
'<div class="wrap"><div class="hdr"><div class="logo s">Rise</div><h1 class="ttl ttl-s">'+ft(now)+'</h1><p class="sub s">'+fd(now)+'</p><div style="margin-top:16px"><span class="pt s '+(ph===2?'pt2':'pt1')+'">'+(ph===2?'‚ú¶ Phase 2 ¬∑ Affirmations':'Phase 1 ¬∑ Day '+S.str+'/21')+'</span></div></div>'+
'<div class="card"><div class="cl s">Current Streak</div><div style="display:flex;align-items:baseline"><span class="bn">'+S.str+'</span><span class="bu s">'+(S.str===1?'day':'days')+'</span></div><div class="s" style="margin-top:8px;font-size:13px;color:var(--brown)">'+(TH-S.str>0?(TH-S.str)+' days to Phase 2':'Phase 2 unlocked ‚Äî you\'re in the zone')+'</div></div>'+
'<div class="card"><div class="cl s">This Week</div><div class="wg">'+wH+'</div></div>'+
'<div class="card"><div class="cl s">Today\'s Check-In</div>'+ciH+'</div>'+
'<div class="card"><div class="cl s">All Time</div><div class="sg"><div><div class="sn" style="color:var(--gold-g)">'+done+'</div><div class="sl s">Days Done</div></div><div><div class="sn" style="color:var(--gold-g)">'+S.str+'</div><div class="sl s">Streak</div></div><div><div class="sn" style="color:var(--red)">'+missed+'</div><div class="sl s">Jokes Sent</div></div></div></div>'+
'<button class="btn bs" id="bset">‚öô Settings</button>'+
'<div class="ft s">'+(ph===1?'No one said 4 AM was easy.':'You\'ve proven it. Keep proving it.')+'</div></div>';

if(S.aff)bi('aov','click',function(){S.aff=false;render()});
bif('bci',doCI);bif('bgps',doGPS);bif('bmiss',doMiss);bif('dci',doCI);bif('dgps',doGPS);bif('dmiss',doMiss);
bi('bset','click',function(){S.showSet=true;render()});
}

function bi(id,ev,fn){if(typeof ev==='function'){fn=ev;ev='click'}var el=document.getElementById(id);if(el)el.addEventListener(ev,fn)}
function bif(id,fn){var el=document.getElementById(id);if(el)el.addEventListener('click',fn)}
function bindIn(id,fn){var el=document.getElementById(id);if(el)el.addEventListener('input',function(e){fn(e.target.value)})}

function doCI(){var t=tk();S.hist[t]=S.hist[t]||{};S.hist[t].ci=true;S.hist[t].cit=new Date().toISOString();S.ci=true;save();render()}
function doGPS(){
  S.gps='checking';render();
  if(!navigator.geolocation){S.gps='error';render();return}
  navigator.geolocation.getCurrentPosition(function(p){
    var d=gd(p.coords.latitude,p.coords.longitude,S.gl.lat,S.gl.lng);
    if(d<=RAD){var t=tk();S.str++;S.hist[t]=S.hist[t]||{};S.hist[t].vl=true;S.hist[t].vt=new Date().toISOString();S.hist[t].d=Math.round(d);S.vl=true;S.gps='success';save();if(S.str>=TH){S.afft=rnd(AFFS);setTimeout(function(){S.aff=true;render()},800)}render()}
    else{S.gps='too_far';render()}
  },function(){S.gps='error';render()},{enableHighAccuracy:true,timeout:10000});
}
function doMiss(){
  var j=rnd(JOKES);S.joke=j;S.str=0;var t=tk();S.hist[t]=S.hist[t]||{};S.hist[t].ms=true;S.hist[t].jk=j;save();
  if(S.cp){var msg=encodeURIComponent("Hey! I missed my morning workout. Here's my punishment dad joke: "+j+" üò¨");window.location.href='sms:'+S.cp+'&body='+msg}
  render();
}

load();initP();render();
setInterval(render,60000);
})();
</script>

</body>
</html>
